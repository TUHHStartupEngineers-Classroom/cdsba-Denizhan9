{
  "hash": "c305910e74770a148d16ca670084eaef",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\n---\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_d3b782506e31e6d47d5e84cc470d69ca'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dagitty)\nlibrary(ggdag)\ndf <- readRDS(\"data/rand_enc.rds\")\n\niv_enc <- dagify(\n  Y ~ D,\n  Y ~ U,\n  D ~ U,\n  D ~ Z,\n  latent = \"U\",\n  outcome = \"Y\",\n  exposure = \"D\",\n  coords = list(x = c(U = 1, D = 0.5, Y = 1.5, Z = 0),\n                y = c(U = 0, D = 1, Y = 1, Z = 1)),\n  labels = c(\"D\" = \"Used feature\", \n             \"Y\" = \"Time on app\", \n             \"U\" = \"Unobserved characteristics\",\n             \"Z\" = \"Random encouragement\")\n)\nggdag(iv_enc, text = T) +\n#  guides(color = \"none\") +\n  geom_dag_text(color = \"white\") +\n  geom_dag_edges(edge_color = \"black\") +\n  geom_dag_label_repel(aes(label = label))\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_e8effae9880609140c71d9a40567ba9f'}\n\n```{.r .cell-code}\n# Load the data\nrand_enc_data <- readRDS(\"data/rand_enc.rds\")\n\n# Task 2: Compute the naive, biased estimate\nnaive_model <- lm(time_spent ~ used_ftr, data = rand_enc_data)\nsummary(naive_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = time_spent ~ used_ftr, data = rand_enc_data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-20.4950  -3.5393   0.0158   3.5961  20.5051 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 18.86993    0.06955   271.3   <2e-16 ***\nused_ftr    10.82269    0.10888    99.4   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.351 on 9998 degrees of freedom\nMultiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \nF-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n# Task 3: Assumption Testing\n# No assumptions related to correlations can be tested with the available data.\n\n# Task 4: Instrumental Variable Estimation\n# Assuming Z is the instrument (replace Z with the actual instrument variable)\nfirst_stage <- lm(used_ftr ~ rand_enc, data = rand_enc_data)\nsummary(first_stage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = used_ftr ~ rand_enc, data = rand_enc_data)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-0.5071 -0.3062 -0.3062  0.4929  0.6938 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 0.306164   0.006851   44.69   <2e-16 ***\nrand_enc    0.200940   0.009624   20.88   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4811 on 9998 degrees of freedom\nMultiple R-squared:  0.04178,\tAdjusted R-squared:  0.04169 \nF-statistic:   436 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n# Second Stage (2SLS)\nsecond_stage <- lm(time_spent ~ fitted(first_stage), data = rand_enc_data)\nsummary(second_stage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = time_spent ~ fitted(first_stage), data = rand_enc_data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-25.8757  -5.4714  -0.3263   5.3807  25.6541 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)          19.3124     0.3129   61.72   <2e-16 ***\nfitted(first_stage)   9.7382     0.7447   13.08   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 7.482 on 9998 degrees of freedom\nMultiple R-squared:  0.01681,\tAdjusted R-squared:  0.01672 \nF-statistic:   171 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n# Compare naive estimate with IV estimate\nnaive_coefficient <- coef(naive_model)[\"used_ftr\"]\niv_coefficient <- coef(second_stage)[\"fitted(first_stage)\"]\n\ncat(\"Naive Estimate: \", naive_coefficient, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNaive Estimate:  10.82269 \n```\n:::\n\n```{.r .cell-code}\ncat(\"IV Estimate: \", iv_coefficient, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nIV Estimate:  9.738175 \n```\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}